<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<style>
/* CSS for Markstat 2.0 using Pandoc 2.0 */
body{padding:14px 28px;}
body, table {font-family: Helvetica, Arial, Sans-serif; font-size: 14px;}
h1, h2, h3, h4 {font-weight: normal; color: #3366cc}
h1 {font-size: 200%;}
h2 {font-size: 150%;}
h3 {font-size: 120%;}
h4 {font-size: 100%; font-weight:bold}
img.center {display:block; margin-left:auto; margin-right:auto}
.small{font-size:8pt;}
a {color: black;}
a:visited {color: #808080;}
a.plain {text-decoration:none;}
a.plain:hover {text-decoration:underline;}
.em {font-weight:bold;}
pre, code {font-family: "lucida console", monospace;}
pre.stata {font-size:13px; line-height:13px;}
pre {padding:8px; border:1px solid #c0c0c0; border-radius:8px; background-color:#fdfdfd;}
code {color:#3366cc; background-color:#fafafa;}
pre code { color:black; background-color:white}
/* Added for Pandoc */
figure > img, div.figure > img {display:block; margin:auto}
figcaption, p.caption {text-align:center; font-weight:bold; color:#3366cc;}
h1.title {text-align:center; margin-bottom:0}
p.author, h2.author {font-style:italic; text-align:center;margin-top:4px;margin-bottom:0}
p.date, h3.date {text-align:center;margin-top:4px; margin-bottom:0}
/* Tables*/
table { margin:auto; border-collapse:collapse; }
table caption { margin-bottom:1ex;}
th, td { padding:4px 6px;}
thead tr:first-child th {border-top:1px solid black; padding-top:6px}
thead tr:last-child  th {padding-bottom:6px}
tbody tr:first-child td {border-top:1px solid black; padding-top:6px}
tbody tr:last-child  td {padding-bottom:6px;}
table tbody:last-child tr:last-child td {border-bottom:1px solid black;}
</style>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Andy Grogan-Kaylor" />
  <title>Count Regression</title>
  <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Count Regression</h1>
<p class="author">Andy Grogan-Kaylor</p>
<p class="date">14 Jun 2020</p>
</header>
<h1 id="key-concepts-and-commands">Key Concepts and Commands</h1>
<style>h1 {color: #00274C;} h2 {color: #2F65A7} blockquote {border-left: 5px solid #ffcb05; margin: 1.5em 10px; padding: 0.5em 10px;}</style>
<ul>
<li>formulas are our friends</li>
</ul>
<p><span class="math inline">\(F(y) = \beta_0 + \beta_1 x_1 + ...\)</span></p>
<p><span class="math inline">\(y = \ln(count): 1, 2, 3, \text{etc.}\)</span></p>
<ul>
<li><p>Think about OR’s, pred. prob., non-linearity</p></li>
<li><p>So much of categorical data analysis depends upon arguments for “functional form”. When do we think these arguments are valid?</p></li>
</ul>
<h1 id="the-count">The Count</h1>
<figure>
<img src="../images/Sesame-Street-optimize.gif" style="width:20.0%" alt="" /><figcaption>The Count and Friends</figcaption>
</figure>
<h1 id="historical-examples-of-count-data-r.1-r.2-r.3">Historical Examples of Count Data 🐴 ☎️ 🏥</h1>
<ul>
<li>🐴 Deaths from horsekicks in the Prussian Army</li>
<li>☎️ Calls to a call center (business, crisis hotline, etc.)</li>
<li>🏥 Arrivals at the Emergency Room</li>
</ul>
<h1 id="other-canonical-examples-of-count-data-r.7-r.8">Other Canonical Examples of Count Data 🌳 🤧</h1>
<ul>
<li>🏵 🌳 🌵 Plants / trees in a field</li>
<li>😷 🤢 😷 Cases of disease / unit area</li>
</ul>
<h1 id="poisson-distribution">Poisson Distribution</h1>
<h2 id="theorizing-about-the-poisson-r.15-r.16-r.17-r.18-r.19-r.20">Theorizing about the Poisson 🐟 🐟 🐟 🌴 🌲 🌳</h2>
<blockquote>
<p>The Poisson distribution is a modified form of the binomial distribution that is useful for the analysis of phenomena characterized by discrete, rare events. For example, in a study of the distribution of a rare plant among a number of quadrats, a majority of plots may contain no specimens, a smaller number a single plant, and still smaller numbers two, three, or more plants. If a single plant per quadrat is expected, the mean µ = 1 and the “0” and “1” classes occur at 37% each, the “2” class at 18%, the “3” class at 6%, and larger classes take up the remaining 2%. The characteristic test for a Poisson is that the variance equals the mean, which in the plant example means that the rare plant is randomly distributed. Note, that, In the distributions above, as the mean µ increases towards 10, the distribution approaches normality.</p>
</blockquote>
<blockquote>
<p>The Poisson may be used to evaluate whether events occur independently in time as well as space. In a classic example, Bortkiewicz (1898) studied the distribution of 122 men kicked to death by horses among ten Prussian army corps over 20 years. In most years in most corps, no one dies from being kicked; in one corp in one year, four men were kicked to death. Does this mean something was amiss in this particular corp? Analysis indicates that the observed frequencies conform quite closely to the expected Poisson frequencies, and that the mean and variance are almost identical, as expected. The corp was just “unlucky” in the sense that it is in the extreme tail of an ordinary run of events.</p>
</blockquote>
<p>http://www.mun.ca/biology/scarr/smcPoisson_distributions.html</p>
<h2 id="reprise-of-normal-distribution">Reprise of Normal Distribution</h2>
<p>Normal distribution:</p>
<p><span class="math display">\[
    P(x) = \frac{1}{\sigma \sqrt{2 \pi}} e^{-(x-\mu)^2/(2 \sigma^2)}
\]</span></p>
<p>Standardized Normal Distribution:</p>
<p><span class="math display">\[
    P(z) = \frac{1}{\sqrt{2 \pi}} e^{-z^2/2}
\]</span></p>
<p>2 parameters:</p>
<p><span class="math display">\[
    x \sim N(\mu,\sigma)
\]</span></p>
<pre class='stata'>. clear all // clear all for simulated data
</pre>
<pre class='stata'>. set obs 1000 // number of observations
number of observations (_N) was 0, now 1,000
</pre>
<pre class='stata'>. generate x = rnormal() // normally distributed random variable
</pre>
<pre class='stata'>. histogram x, title("Normally Distributed Random Variable") scheme(burd)
(bin=29, start=-3.1348748, width=.20447365)
</pre>
<pre class='stata'>. graph export myhistogram.png, width(500) replace
(file myhistogram.png written in PNG format)
</pre>
<figure>
<img src="myhistogram.png" alt="" /><figcaption>histogram of random normal variable</figcaption>
</figure>
<h2 id="poisson-distribution-1">Poisson Distribution</h2>
<p><span class="math display">\[
    P(Y=y) = e^{-\lambda} \frac{\lambda^y}{y!}
\]</span></p>
<blockquote>
<p><span style="background-color: #FFFF00">A Poisson with large lambda looks very similar to a normal distribution.</span></p>
</blockquote>
<pre class='stata'>. generate w = rpoisson(.5)
</pre>
<pre class='stata'>. histogram w, title("Poisson Distributed Random Variable") scheme(burd)
(bin=29, start=0, width=.17241379)
</pre>
<pre class='stata'>. graph export myhistogram2.png, width(500) replace
(file myhistogram2.png written in PNG format)
</pre>
<figure>
<img src="myhistogram2.png" alt="" /><figcaption>histogram of random Poisson variable</figcaption>
</figure>
<h2 id="poisson-is-the-natural-form-for-observations-distributed-in-time-or-space-r.21-r.22-r.23-r.24-r.25-r.26">Poisson is the Natural Form for Observations Distributed in Time or Space 🏭 🏭 🏨 ⏳ ⏳ ⏳</h2>
<p><span class="math display">\[ 
    x \sim Poisson(\lambda)
\]</span></p>
<blockquote>
<p><span class="math inline">\(\lambda\)</span> is both mean and variance.</p>
</blockquote>
<pre class='stata'>. clear all
</pre>
<pre class='stata'>. set obs 20
number of observations (_N) was 0, now 20
</pre>
<pre class='stata'>. generate field = _n // field number
</pre>
<pre class='stata'>. generate mycount = rpoisson(1)
</pre>
<pre class='stata'>. expand mycount // create individual observations
(8 zero counts ignored; observations not deleted)
(12 observations created)
</pre>
<pre class='stata'>. generate x = runiform(1,10) // random x coordinate
</pre>
<pre class='stata'>. generate y =runiform(1,10) // random y coordinate
</pre>
<pre class='stata'>. generate mylabel = "🦆"
</pre>
<pre class='stata'>. twoway scatter y x, ///
> by(field, title("Randomly Located Ducks")) ///
> mlab(mylabel) mlabsize(vlarge) ///
> msymbol(none)  ///
> legend(order(1 "🦆 Duck")) ///
> scheme(burd) plotr(fcolor(olive_teal))
</pre>
<pre class='stata'>. graph export ducks.png, width(1000) replace
(file ducks.png written in PNG format)
</pre>
<figure>
<img src="ducks.png" style="width:50.0%" alt="" /><figcaption>Randomly Located Ducks</figcaption>
</figure>
<h1 id="poisson-regression">Poisson Regression</h1>
<pre class='stata'>. clear all
</pre>
<pre class='stata'>. set maxvar 10000
</pre>
<pre class='stata'>. use "/Users/agrogan/Box Sync/DATA WAREHOUSE/General Social Survey/GSS7218_R1.DTA", clear
</pre>
<pre class='stata'>. codebook numprobs // data from 2002

─────────────────────────────────────────────────────────────────────────────────────────────
numprobs                                          how many friends close to discuss problems 
─────────────────────────────────────────────────────────────────────────────────────────────

                  type:  numeric (byte)
                 label:  LABJP, but 33 nonmissing values are not labeled

                 range:  [0,96]                       units:  1
         unique values:  34                       missing .:  0/64,814
       unique mv codes:  3                       missing .*:  62,141/64,814

              examples:  .i    IAP
                         .i    IAP
                         .i    IAP
                         .i    IAP
</pre>
<pre class='stata'>. generate coninc_10K = coninc / 10000 // $10K chunks
(6,520 missing values generated)
</pre>
<pre class='stata'>. poisson numprobs coninc_10K i.race sex age

Iteration 0:   log likelihood = -13850.015  
Iteration 1:   log likelihood = -13850.011  
Iteration 2:   log likelihood = -13850.011  

Poisson regression                              Number of obs     =      2,406
                                                LR chi2(5)        =    1035.88
                                                Prob > chi2       =     0.0000
Log likelihood = -13850.011                     Pseudo R2         =     0.0360

─────────────┬────────────────────────────────────────────────────────────────
    numprobs │      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
─────────────┼────────────────────────────────────────────────────────────────
  coninc_10K │   .0319119   .0015338    20.81   0.000     .0289058     .034918
             │
        race │
      black  │  -.4359226   .0254022   -17.16   0.000    -.4857101   -.3861351
      other  │  -.3791775   .0344591   -11.00   0.000    -.4467161   -.3116389
             │
         sex │   .1335163   .0145586     9.17   0.000      .104982    .1620507
         age │  -.0007319   .0004376    -1.67   0.094    -.0015895    .0001257
       _cons │   1.812817   .0332514    54.52   0.000     1.747646    1.877989
─────────────┴────────────────────────────────────────────────────────────────
</pre>
<h1 id="incidence-rate-ratios">Incidence Rate Ratios</h1>
<pre class='stata'>. poisson, irr

Poisson regression                              Number of obs     =      2,406
                                                LR chi2(5)        =    1035.88
                                                Prob > chi2       =     0.0000
Log likelihood = -13850.011                     Pseudo R2         =     0.0360

─────────────┬────────────────────────────────────────────────────────────────
    numprobs │        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
─────────────┼────────────────────────────────────────────────────────────────
  coninc_10K │   1.032427   .0015835    20.81   0.000     1.029328    1.035535
             │
        race │
      black  │   .6466678   .0164268   -17.16   0.000     .6152602    .6796787
      other  │   .6844241   .0235846   -11.00   0.000     .6397255    .7322459
             │
         sex │    1.14284   .0166382     9.17   0.000     1.110691     1.17592
         age │   .9992684   .0004372    -1.67   0.094     .9984118    1.000126
       _cons │   6.127687   .2037541    54.52   0.000     5.741071    6.540338
─────────────┴────────────────────────────────────────────────────────────────
Note: _cons estimates baseline incidence rate.
</pre>
<h1 id="negative-binomial-distribution">Negative Binomial Distribution</h1>
<h2 id="over-dispersion">Over-Dispersion</h2>
<p>Due to population heterogeneity (diversity, variation), variance may be <span class="math inline">\(&gt;\)</span> mean. This is often empirically the case.</p>
<p><span class="math display">\[
    \text{var}(y) &gt; \text{mean}(y)
\]</span></p>
<p><span class="math display">\[
    y \sim Poisson(\mu)
\]</span></p>
<p><span class="math display">\[
    \ln(\mu) = \beta_0 + \beta_1 x + \text{offset} + \text{dispersion} + etc.
\]</span></p>
<h2 id="regression">Regression</h2>
<pre class='stata'>. nbreg numprobs coninc_10K i.race sex age

Fitting Poisson model:

Iteration 0:   log likelihood = -13850.015  
Iteration 1:   log likelihood = -13850.011  
Iteration 2:   log likelihood = -13850.011  

Fitting constant-only model:

Iteration 0:   log likelihood =  -7577.985  
Iteration 1:   log likelihood = -7561.8388  
Iteration 2:   log likelihood =   -7561.83  
Iteration 3:   log likelihood =   -7561.83  

Fitting full model:

Iteration 0:   log likelihood = -7496.5295  
Iteration 1:   log likelihood = -7493.7917  
Iteration 2:   log likelihood = -7493.7857  
Iteration 3:   log likelihood = -7493.7857  

Negative binomial regression                    Number of obs     =      2,406
                                                LR chi2(5)        =     136.09
Dispersion     = mean                           Prob > chi2       =     0.0000
Log likelihood = -7493.7857                     Pseudo R2         =     0.0090

─────────────┬────────────────────────────────────────────────────────────────
    numprobs │      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
─────────────┼────────────────────────────────────────────────────────────────
  coninc_10K │   .0306399   .0045093     6.79   0.000     .0218017     .039478
             │
        race │
      black  │   -.432147   .0596002    -7.25   0.000    -.5489613   -.3153328
      other  │  -.3843031   .0830998    -4.62   0.000    -.5471758   -.2214304
             │
         sex │   .1154665   .0393671     2.93   0.003     .0383084    .1926246
         age │  -.0009527   .0011445    -0.83   0.405    -.0031958    .0012904
       _cons │   1.857757   .0873184    21.28   0.000     1.686616    2.028898
─────────────┼────────────────────────────────────────────────────────────────
    /lnalpha │  -.2378643   .0317921                     -.3001755    -.175553
─────────────┼────────────────────────────────────────────────────────────────
       alpha │   .7883097    .025062                      .7406882    .8389929
─────────────┴────────────────────────────────────────────────────────────────
LR test of alpha=0: chibar2(01) = 1.3e+04              Prob >= chibar2 = 0.000
</pre>
<h2 id="predicted-values">Predicted Values</h2>
<h2 id="exposure">Exposure</h2>
<p>In some data sets, we will have a <em>years exposed</em> or <em>time exposed</em> variable. It is important to control for this variable.</p>
<h1 id="zero-inflated-models">Zero-Inflated Models</h1>
</body>
</html>
