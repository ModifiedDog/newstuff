<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Andy Grogan-Kaylor" />
  <title>Count Regression</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" type="text/css" media="screen, projection, print"
    href="https://www.w3.org/Talks/Tools/Slidy2/styles/slidy.css" />
  <link rel="stylesheet" type="text/css" media="screen, projection, print"
   href="../UMslidy.css" />
  <script src="https://www.w3.org/Talks/Tools/Slidy2/scripts/slidy.js"
    charset="utf-8" type="text/javascript"></script>
	<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
</head>
<body>
<div class="slide titlepage">
  <h1 class="title">Count Regression</h1>
  <p class="author">
Andy Grogan-Kaylor
  </p>
</div>
<div class="slide section level2">

<p>Andy Grogan-Kaylor</p>
<p>20 Oct 2020</p>
</div>
<div id="key-concepts-and-commands" class="title-slide slide section level1"><h1>Key Concepts and Commands</h1><ul class="incremental">
<li>formulas are our friends</li>
</ul>
<p><span class="math inline">\(F(y) = \beta_0 + \beta_1 x_1 + ...\)</span></p>
<p><span class="math inline">\(y = \ln(count): 1, 2, 3, \text{etc.}\)</span></p>
<ul class="incremental">
<li><p>Think about OR’s, pred. prob., non-linearity</p></li>
<li><p>So much of categorical data analysis depends upon arguments for “functional form”. When do we think these arguments are valid?</p></li>
</ul></div>
<div id="the-count" class="title-slide slide section level1"><h1>The Count</h1><div class="figure">
<img src="../images/Sesame-Street-optimize.gif" alt="" />
<p class="caption">The Count and Friends</p>
</div></div>
<div id="historical-examples-of-count-data-r.1-r.2-r.3" class="title-slide slide section level1"><h1>Historical Examples of Count Data 🐴 ☎️ 🏥</h1><ul class="incremental">
<li>🐴 Deaths from horsekicks in the Prussian Army</li>
<li>☎️ Calls to a call center (business, crisis hotline, etc.)</li>
<li>🏥 Arrivals at the Emergency Room</li>
</ul></div>
<div id="other-canonical-examples-of-count-data-r.7-r.8" class="title-slide slide section level1"><h1>Other Canonical Examples of Count Data 🌴 🤧</h1><ul class="incremental">
<li>🌱 🌲 🌰 Plants / trees in a field</li>
<li>🤧 🤒 💊 Cases of disease / unit area</li>
</ul></div>
<div id="poisson-distribution" class="title-slide slide section level1"><h1>Poisson Distribution</h1></div><div id="theorizing-about-the-poisson-r.15-r.16-r.17-r.18-r.19-r.20" class="slide section level2">
<h1>Theorizing about the Poisson 🐟 🐟 🐟 🌴 🌲 🌳</h1>
<blockquote>
<p>The Poisson distribution is a modified form of the binomial distribution that is useful for the analysis of phenomena characterized by discrete, rare events. For example, in a study of the distribution of a rare plant among a number of quadrats, a majority of plots may contain no specimens, a smaller number a single plant, and still smaller numbers two, three, or more plants. If a single plant per quadrat is expected, the mean µ = 1 and the “0” and “1” classes occur at 37% each, the “2” class at 18%, the “3” class at 6%, and larger classes take up the remaining 2%. The characteristic test for a Poisson is that the variance equals the mean, which in the plant example means that the rare plant is randomly distributed. Note, that, In the distributions above, as the mean µ increases towards 10, the distribution approaches normality.</p>
</blockquote>
<blockquote>
<p>The Poisson may be used to evaluate whether events occur independently in time as well as space. In a classic example, Bortkiewicz (1898) studied the distribution of 122 men kicked to death by horses among ten Prussian army corps over 20 years. In most years in most corps, no one dies from being kicked; in one corp in one year, four men were kicked to death. Does this mean something was amiss in this particular corp? Analysis indicates that the observed frequencies conform quite closely to the expected Poisson frequencies, and that the mean and variance are almost identical, as expected. The corp was just “unlucky” in the sense that it is in the extreme tail of an ordinary run of events.</p>
</blockquote>
<p><a href="http://www.mun.ca/biology/scarr/smcPoisson_distributions.html">http://www.mun.ca/biology/scarr/smcPoisson_distributions.html</a></p>
</div><div id="reprise-of-normal-distribution" class="slide section level2">
<h1>Reprise of Normal Distribution</h1>
<p>Normal distribution:</p>
<p><span class="math display">\[ P(x) = \frac{1}{\sigma \sqrt{2 \pi}} e^{-(x-\mu)^2/(2 \sigma^2)} \]</span></p>
<p>Standardized Normal Distribution:</p>
<p><span class="math display">\[ P(z) = \frac{1}{\sqrt{2 \pi}} e^{-z^2/2} \]</span></p>
<p>2 parameters:</p>
<p><span class="math display">\[ x \sim N(\mu,\sigma) \]</span></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb1-1"><a href="#cb1-1"></a>. <span class="kw">clear</span> <span class="ot">all</span> <span class="co">// clear all for simulated data</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb2-1"><a href="#cb2-1"></a>. <span class="kw">set</span> <span class="kw">obs</span> 1000 <span class="co">// number of observations</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>number <span class="kw">of</span> observations (_N) was 0, now 1,000</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb3-1"><a href="#cb3-1"></a>. <span class="kw">generate</span> x = rnormal() <span class="co">// normally distributed random variable</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb4-1"><a href="#cb4-1"></a>. <span class="kw">histogram</span> x, <span class="bn">title</span>(<span class="st">&quot;Normally Distributed Random Variable&quot;</span>) <span class="dv">scheme</span>(burd)</span>
<span id="cb4-2"><a href="#cb4-2"></a>(<span class="bn">bin</span>=29, <span class="bn">start</span>=-3.659894, <span class="kw">width</span>=.27542746)</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb5-1"><a href="#cb5-1"></a>. <span class="kw">graph</span> <span class="kw">export</span> myhistogram.png, <span class="kw">width</span>(500) <span class="kw">replace</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>(file myhistogram.png written <span class="kw">in</span> PNG <span class="kw">format</span>)</span></code></pre></div>
<div class="figure">
<img src="myhistogram.png" alt="" />
<p class="caption">histogram of random normal variable</p>
</div>
</div><div id="poisson-distribution-1" class="slide section level2">
<h1>Poisson Distribution</h1>
<p><span class="math display">\[ P(Y=y) = e^{-\lambda} \frac{\lambda^y}{y!} \]</span></p>
<blockquote>
<p><span style="background-color: #FFFF00">A Poisson with large lambda looks very similar to a normal distribution.</span></p>
</blockquote>
<div class="sourceCode" id="cb6"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb6-1"><a href="#cb6-1"></a>. <span class="kw">generate</span> <span class="fu">w</span> = rpoisson(.5)</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb7-1"><a href="#cb7-1"></a>. <span class="kw">histogram</span> <span class="fu">w</span>, <span class="bn">title</span>(<span class="st">&quot;Poisson Distributed Random Variable&quot;</span>) <span class="dv">scheme</span>(burd)</span>
<span id="cb7-2"><a href="#cb7-2"></a>(<span class="bn">bin</span>=29, <span class="bn">start</span>=0, <span class="kw">width</span>=.10344828)</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb8-1"><a href="#cb8-1"></a>. <span class="kw">graph</span> <span class="kw">export</span> myhistogram2.png, <span class="kw">width</span>(500) <span class="kw">replace</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>(file myhistogram2.png written <span class="kw">in</span> PNG <span class="kw">format</span>)</span></code></pre></div>
<div class="figure">
<img src="myhistogram2.png" alt="" />
<p class="caption">histogram of random Poisson variable</p>
</div>
</div><div id="poisson-is-the-natural-form-for-observations-distributed-in-time-or-space-r.21-r.22-r.23-r.24-r.25-r.26" class="slide section level2">
<h1>Poisson is the Natural Form for Observations Distributed in Time or Space 🏭 🏦 🏦 ⏳ ⏳ ⏳</h1>
<p><span class="math display">\[ x \sim Poisson(\lambda) \]</span></p>
<blockquote>
<p><span class="math inline">\(\lambda\)</span> is both mean and variance.</p>
</blockquote>
<div class="sourceCode" id="cb9"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb9-1"><a href="#cb9-1"></a>. <span class="kw">clear</span> <span class="ot">all</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb10-1"><a href="#cb10-1"></a>. <span class="kw">set</span> <span class="kw">obs</span> 20</span>
<span id="cb10-2"><a href="#cb10-2"></a>number <span class="kw">of</span> observations (_N) was 0, now 20</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb11-1"><a href="#cb11-1"></a>. <span class="kw">generate</span> <span class="fu">field</span> = <span class="dt">_n</span> <span class="co">// field number</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb12-1"><a href="#cb12-1"></a>. <span class="kw">generate</span> mycount = rpoisson(1)</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb13-1"><a href="#cb13-1"></a>. expand mycount <span class="co">// create individual observations</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>(10 <span class="bn">zero</span> counts ignored; observations <span class="kw">not</span> deleted)</span>
<span id="cb13-3"><a href="#cb13-3"></a>(6 observations created)</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb14-1"><a href="#cb14-1"></a>. <span class="kw">generate</span> x = runiform(1,10) <span class="co">// random x coordinate</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb15-1"><a href="#cb15-1"></a>. <span class="kw">generate</span> <span class="fu">y</span> =runiform(1,10) <span class="co">// random y coordinate</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb16-1"><a href="#cb16-1"></a>. <span class="kw">generate</span> mylabel = <span class="st">&quot;🦆&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb17-1"><a href="#cb17-1"></a>. <span class="kw">twoway</span> <span class="kw">scatter</span> <span class="fu">y</span> x, <span class="co">///</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>&gt; <span class="kw">by</span>(<span class="fu">field</span>, <span class="bn">title</span>(<span class="st">&quot;Randomly Located Ducks&quot;</span>)) <span class="co">///</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>&gt; mlab(mylabel) <span class="bn">mlabsize</span>(vlarge) <span class="co">///</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>&gt; <span class="bn">msymbol</span>(<span class="kw">none</span>)  <span class="co">///</span></span>
<span id="cb17-5"><a href="#cb17-5"></a>&gt; <span class="bn">legend</span>(<span class="kw">order</span>(1 <span class="st">&quot;🦆 Duck&quot;</span>)) <span class="co">///</span></span>
<span id="cb17-6"><a href="#cb17-6"></a>&gt; <span class="dv">scheme</span>(burd) plotr(fcolor(<span class="bn">olive_teal</span>))</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb18-1"><a href="#cb18-1"></a>. <span class="kw">graph</span> <span class="kw">export</span> ducks.png, <span class="kw">width</span>(1000) <span class="kw">replace</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>(file ducks.png written <span class="kw">in</span> PNG <span class="kw">format</span>)</span></code></pre></div>
<div class="figure">
<img src="ducks.png" alt="" />
<p class="caption">Randomly Located Ducks</p>
</div>
<div class="sourceCode" id="cb19"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb19-1"><a href="#cb19-1"></a>. <span class="kw">generate</span> t = runiform(1,10) <span class="co">// random time coordinate</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb20-1"><a href="#cb20-1"></a>. <span class="kw">generate</span> y2 = runiform(1,2) <span class="co">// random y coordinate</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb21-1"><a href="#cb21-1"></a>. <span class="kw">generate</span> mylabel2 = <span class="st">&quot;🔥&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb22-1"><a href="#cb22-1"></a>. <span class="kw">generate</span> timeperiod = <span class="fu">field</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb23-1"><a href="#cb23-1"></a>. <span class="kw">twoway</span> <span class="kw">scatter</span> y2 t, <span class="co">///</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>&gt; <span class="kw">by</span>(timeperiod, <span class="bn">title</span>(<span class="st">&quot;Forest Fires At Random Times&quot;</span>, <span class="kw">size</span>(vhuge)) <span class="bn">cols</span>(10)) </span>
<span id="cb23-3"><a href="#cb23-3"></a>&gt; <span class="co">///</span></span>
<span id="cb23-4"><a href="#cb23-4"></a>&gt; <span class="bn">ytitle</span>(<span class="st">&quot;&quot;</span>, <span class="kw">size</span>(<span class="bn">zero</span>)) <span class="kw">ylabel</span>(<span class="kw">none</span>) <span class="bn">xtitle</span>(<span class="st">&quot;&quot;</span>, <span class="kw">size</span>(<span class="bn">zero</span>)) <span class="kw">xlabel</span>(<span class="kw">none</span>) <span class="co">///</span></span>
<span id="cb23-5"><a href="#cb23-5"></a>&gt; <span class="bn">subtitle</span>(, <span class="kw">size</span>(vhuge)) <span class="co">///</span></span>
<span id="cb23-6"><a href="#cb23-6"></a>&gt; mlab(mylabel2) <span class="bn">mlabsize</span>(vhuge) <span class="co">///</span></span>
<span id="cb23-7"><a href="#cb23-7"></a>&gt; <span class="bn">msymbol</span>(<span class="kw">none</span>)  <span class="co">///</span></span>
<span id="cb23-8"><a href="#cb23-8"></a>&gt; <span class="bn">legend</span>(<span class="kw">order</span>(1 <span class="st">&quot;🔥 Forest Fire&quot;</span>)) <span class="co">///</span></span>
<span id="cb23-9"><a href="#cb23-9"></a>&gt; <span class="dv">scheme</span>(burd) plotr(fcolor(gs14)) <span class="co">///</span></span>
<span id="cb23-10"><a href="#cb23-10"></a>&gt; <span class="bn">xsize</span>(5) <span class="bn">ysize</span>(1)</span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb24-1"><a href="#cb24-1"></a>. <span class="kw">graph</span> <span class="kw">export</span> fires.png, <span class="kw">width</span>(1000) <span class="kw">replace</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>(file fires.png written <span class="kw">in</span> PNG <span class="kw">format</span>)</span></code></pre></div>
<div class="figure">
<img src="fires.png" alt="" />
<p class="caption">Forest Fires At Random Times</p>
</div>
</div>
<div id="poisson-regression" class="title-slide slide section level1"><h1>Poisson Regression</h1><div class="sourceCode" id="cb25"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb25-1"><a href="#cb25-1"></a>. <span class="kw">clear</span> <span class="ot">all</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb26-1"><a href="#cb26-1"></a>. <span class="kw">set</span> <span class="dv">maxvar</span> 10000</span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb27-1"><a href="#cb27-1"></a>. <span class="kw">use</span> <span class="st">&quot;/Users/agrogan/Box Sync/DATA WAREHOUSE/General Social Survey/GSS7218_R1</span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="st">&gt; .DTA&quot;</span>, <span class="kw">clear</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb28-1"><a href="#cb28-1"></a>. <span class="kw">codebook</span> numprobs <span class="co">// data from 2002</span></span>
<span id="cb28-2"><a href="#cb28-2"></a></span>
<span id="cb28-3"><a href="#cb28-3"></a>──────────────────────────────────────────────────────────────────────────────</span>
<span id="cb28-4"><a href="#cb28-4"></a>numprobs                           how many friends <span class="kw">close</span> to discuss problems </span>
<span id="cb28-5"><a href="#cb28-5"></a>──────────────────────────────────────────────────────────────────────────────</span>
<span id="cb28-6"><a href="#cb28-6"></a></span>
<span id="cb28-7"><a href="#cb28-7"></a>                  <span class="dv">type</span>:  <span class="kw">numeric</span> (<span class="kw">byte</span>)</span>
<span id="cb28-8"><a href="#cb28-8"></a>                 <span class="kw">label</span>:  LABJP, but 33 nonmissing <span class="kw">values</span> are <span class="kw">not</span> labeled</span>
<span id="cb28-9"><a href="#cb28-9"></a></span>
<span id="cb28-10"><a href="#cb28-10"></a>                 <span class="kw">range</span>:  [0,96]                       units:  1</span>
<span id="cb28-11"><a href="#cb28-11"></a>         <span class="kw">unique</span> <span class="kw">values</span>:  34                       <span class="fu">missing</span> .:  0/64,814</span>
<span id="cb28-12"><a href="#cb28-12"></a>       <span class="kw">unique</span> mv codes:  3                       <span class="fu">missing</span> .*:  62,141/64,814</span>
<span id="cb28-13"><a href="#cb28-13"></a></span>
<span id="cb28-14"><a href="#cb28-14"></a>              examples:  .i    IAP</span>
<span id="cb28-15"><a href="#cb28-15"></a>                         .i    IAP</span>
<span id="cb28-16"><a href="#cb28-16"></a>                         .i    IAP</span>
<span id="cb28-17"><a href="#cb28-17"></a>                         .i    IAP</span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb29-1"><a href="#cb29-1"></a>. <span class="kw">recode</span> hispanic (1=0)(2/<span class="fu">max</span> = 1), <span class="kw">generate</span>(hisp) <span class="co">// dichotomous variable</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>(26650 differences between hispanic and hisp)</span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb30-1"><a href="#cb30-1"></a>. <span class="kw">generate</span> coninc_10K = coninc / 10000 <span class="co">// $10K chunks</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>(6,520 <span class="fu">missing</span> <span class="kw">values</span> generated)</span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb31-1"><a href="#cb31-1"></a>. <span class="kw">poisson</span> numprobs coninc_10K i.race hisp i.<span class="kw">class</span> sex age</span>
<span id="cb31-2"><a href="#cb31-2"></a></span>
<span id="cb31-3"><a href="#cb31-3"></a>Iteration 0:   <span class="fu">log</span> likelihood =  -13723.05  </span>
<span id="cb31-4"><a href="#cb31-4"></a>Iteration 1:   <span class="fu">log</span> likelihood = -13723.046  </span>
<span id="cb31-5"><a href="#cb31-5"></a>Iteration 2:   <span class="fu">log</span> likelihood = -13723.046  </span>
<span id="cb31-6"><a href="#cb31-6"></a></span>
<span id="cb31-7"><a href="#cb31-7"></a>Poisson regression                              Number <span class="kw">of</span> <span class="kw">obs</span>     =      2,399</span>
<span id="cb31-8"><a href="#cb31-8"></a>                                                LR <span class="fu">chi2</span>(9)        =    1125.86</span>
<span id="cb31-9"><a href="#cb31-9"></a>                                                Prob &gt; <span class="fu">chi2</span>       =     0.0000</span>
<span id="cb31-10"><a href="#cb31-10"></a>Log likelihood = -13723.046                     Pseudo R2         =     0.0394</span>
<span id="cb31-11"><a href="#cb31-11"></a></span>
<span id="cb31-12"><a href="#cb31-12"></a>─────────────┬────────────────────────────────────────────────────────────────</span>
<span id="cb31-13"><a href="#cb31-13"></a>    numprobs │      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]</span>
<span id="cb31-14"><a href="#cb31-14"></a>─────────────┼────────────────────────────────────────────────────────────────</span>
<span id="cb31-15"><a href="#cb31-15"></a>  coninc_10K │   .0288957   .0017165    16.83   0.000     .0255315    .0322599</span>
<span id="cb31-16"><a href="#cb31-16"></a>             │</span>
<span id="cb31-17"><a href="#cb31-17"></a>        race │</span>
<span id="cb31-18"><a href="#cb31-18"></a>      <span class="bn">black</span>  │  -.4409339   .0256346   -17.20   0.000    -.4911767    -.390691</span>
<span id="cb31-19"><a href="#cb31-19"></a>      other  │  -.2608266    .037588    -6.94   0.000    -.3344978   -.1871555</span>
<span id="cb31-20"><a href="#cb31-20"></a>             │</span>
<span id="cb31-21"><a href="#cb31-21"></a>        hisp │  -.2247009    .033778    -6.65   0.000    -.2909047   -.1584972</span>
<span id="cb31-22"><a href="#cb31-22"></a>             │</span>
<span id="cb31-23"><a href="#cb31-23"></a>       <span class="kw">class</span> │</span>
<span id="cb31-24"><a href="#cb31-24"></a>working c..  │  -.1267131   .0342909    -3.70   0.000    -.1939219   -.0595042</span>
<span id="cb31-25"><a href="#cb31-25"></a>middle cl..  │  -.0173452   .0349358    -0.50   0.620    -.0858182    .0511278</span>
<span id="cb31-26"><a href="#cb31-26"></a><span class="fu">upper</span> <span class="kw">class</span>  │  -.0300967    .049953    -0.60   0.547    -.1280028    .0678095</span>
<span id="cb31-27"><a href="#cb31-27"></a>             │</span>
<span id="cb31-28"><a href="#cb31-28"></a>         sex │   .1291068   .0146144     8.83   0.000     .1004631    .1577506</span>
<span id="cb31-29"><a href="#cb31-29"></a>         age │  -.0013719   .0004456    -3.08   0.002    -.0022453   -.0004986</span>
<span id="cb31-30"><a href="#cb31-30"></a>       <span class="dt">_cons</span> │   1.935927   .0457132    42.35   0.000     1.846331    2.025523</span>
<span id="cb31-31"><a href="#cb31-31"></a>─────────────┴────────────────────────────────────────────────────────────────</span></code></pre></div></div>
<div id="incidence-rate-ratios" class="title-slide slide section level1"><h1>Incidence Rate Ratios</h1><div class="sourceCode" id="cb32"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb32-1"><a href="#cb32-1"></a>. <span class="kw">poisson</span>, <span class="kw">irr</span></span>
<span id="cb32-2"><a href="#cb32-2"></a></span>
<span id="cb32-3"><a href="#cb32-3"></a>Poisson regression                              Number <span class="kw">of</span> <span class="kw">obs</span>     =      2,399</span>
<span id="cb32-4"><a href="#cb32-4"></a>                                                LR <span class="fu">chi2</span>(9)        =    1125.86</span>
<span id="cb32-5"><a href="#cb32-5"></a>                                                Prob &gt; <span class="fu">chi2</span>       =     0.0000</span>
<span id="cb32-6"><a href="#cb32-6"></a>Log likelihood = -13723.046                     Pseudo R2         =     0.0394</span>
<span id="cb32-7"><a href="#cb32-7"></a></span>
<span id="cb32-8"><a href="#cb32-8"></a>─────────────┬────────────────────────────────────────────────────────────────</span>
<span id="cb32-9"><a href="#cb32-9"></a>    numprobs │        IRR   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]</span>
<span id="cb32-10"><a href="#cb32-10"></a>─────────────┼────────────────────────────────────────────────────────────────</span>
<span id="cb32-11"><a href="#cb32-11"></a>  coninc_10K │   1.029317   .0017668    16.83   0.000      1.02586    1.032786</span>
<span id="cb32-12"><a href="#cb32-12"></a>             │</span>
<span id="cb32-13"><a href="#cb32-13"></a>        race │</span>
<span id="cb32-14"><a href="#cb32-14"></a>      <span class="bn">black</span>  │   .6434353   .0164942   -17.20   0.000      .611906    .6765892</span>
<span id="cb32-15"><a href="#cb32-15"></a>      other  │   .7704145   .0289583    -6.94   0.000     .7156974    .8293148</span>
<span id="cb32-16"><a href="#cb32-16"></a>             │</span>
<span id="cb32-17"><a href="#cb32-17"></a>        hisp │   .7987551   .0269804    -6.65   0.000     .7475869    .8534254</span>
<span id="cb32-18"><a href="#cb32-18"></a>             │</span>
<span id="cb32-19"><a href="#cb32-19"></a>       <span class="kw">class</span> │</span>
<span id="cb32-20"><a href="#cb32-20"></a>working c..  │   .8809864   .0302098    -3.70   0.000     .8237222    .9422316</span>
<span id="cb32-21"><a href="#cb32-21"></a>middle cl..  │   .9828044   .0343351    -0.50   0.620     .9177611    1.052457</span>
<span id="cb32-22"><a href="#cb32-22"></a><span class="fu">upper</span> <span class="kw">class</span>  │   .9703517    .048472    -0.60   0.547     .8798509    1.070161</span>
<span id="cb32-23"><a href="#cb32-23"></a>             │</span>
<span id="cb32-24"><a href="#cb32-24"></a>         sex │   1.137812   .0166285     8.83   0.000     1.105683    1.170874</span>
<span id="cb32-25"><a href="#cb32-25"></a>         age │    .998629    .000445    -3.08   0.002     .9977572    .9995015</span>
<span id="cb32-26"><a href="#cb32-26"></a>       <span class="dt">_cons</span> │   6.930466   .3168141    42.35   0.000     6.336526    7.580077</span>
<span id="cb32-27"><a href="#cb32-27"></a>─────────────┴────────────────────────────────────────────────────────────────</span>
<span id="cb32-28"><a href="#cb32-28"></a>Note: <span class="dt">_cons</span> <span class="kw">estimates</span> baseline incidence rate.</span></code></pre></div></div>
<div id="negative-binomial-distribution" class="title-slide slide section level1"><h1>Negative Binomial Distribution</h1></div><div id="over-dispersion" class="slide section level2">
<h1>Over-Dispersion</h1>
<p>Due to population heterogeneity (diversity, variation), variance may be <span class="math inline">\(&gt;\)</span> mean. This is often empirically the case.</p>
<p><span class="math display">\[ \text{var}(y) &gt; \text{mean}(y) \]</span></p>
<p><span class="math display">\[ y \sim Poisson(\mu) \]</span></p>
<p><span class="math display">\[ \ln(\mu) = \beta_0 + \beta_1 x + \text{offset} + \text{dispersion} + etc. \]</span></p>
</div><div id="regression" class="slide section level2">
<h1>Regression</h1>
<div class="sourceCode" id="cb33"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb33-1"><a href="#cb33-1"></a>. <span class="kw">nbreg</span> numprobs coninc_10K i.race hisp i.<span class="kw">class</span> sex age</span>
<span id="cb33-2"><a href="#cb33-2"></a></span>
<span id="cb33-3"><a href="#cb33-3"></a>Fitting Poisson <span class="kw">model</span>:</span>
<span id="cb33-4"><a href="#cb33-4"></a></span>
<span id="cb33-5"><a href="#cb33-5"></a>Iteration 0:   <span class="fu">log</span> likelihood =  -13723.05  </span>
<span id="cb33-6"><a href="#cb33-6"></a>Iteration 1:   <span class="fu">log</span> likelihood = -13723.046  </span>
<span id="cb33-7"><a href="#cb33-7"></a>Iteration 2:   <span class="fu">log</span> likelihood = -13723.046  </span>
<span id="cb33-8"><a href="#cb33-8"></a></span>
<span id="cb33-9"><a href="#cb33-9"></a>Fitting constant-only <span class="kw">model</span>:</span>
<span id="cb33-10"><a href="#cb33-10"></a></span>
<span id="cb33-11"><a href="#cb33-11"></a>Iteration 0:   <span class="fu">log</span> likelihood = -7550.8728  </span>
<span id="cb33-12"><a href="#cb33-12"></a>Iteration 1:   <span class="fu">log</span> likelihood = -7534.4222  </span>
<span id="cb33-13"><a href="#cb33-13"></a>Iteration 2:   <span class="fu">log</span> likelihood = -7534.4131  </span>
<span id="cb33-14"><a href="#cb33-14"></a>Iteration 3:   <span class="fu">log</span> likelihood = -7534.4131  </span>
<span id="cb33-15"><a href="#cb33-15"></a></span>
<span id="cb33-16"><a href="#cb33-16"></a>Fitting full <span class="kw">model</span>:</span>
<span id="cb33-17"><a href="#cb33-17"></a></span>
<span id="cb33-18"><a href="#cb33-18"></a>Iteration 0:   <span class="fu">log</span> likelihood = -7461.8838  </span>
<span id="cb33-19"><a href="#cb33-19"></a>Iteration 1:   <span class="fu">log</span> likelihood = -7458.4673  </span>
<span id="cb33-20"><a href="#cb33-20"></a>Iteration 2:   <span class="fu">log</span> likelihood = -7458.4576  </span>
<span id="cb33-21"><a href="#cb33-21"></a>Iteration 3:   <span class="fu">log</span> likelihood = -7458.4576  </span>
<span id="cb33-22"><a href="#cb33-22"></a></span>
<span id="cb33-23"><a href="#cb33-23"></a>Negative binomial regression                    Number <span class="kw">of</span> <span class="kw">obs</span>     =      2,399</span>
<span id="cb33-24"><a href="#cb33-24"></a>                                                LR <span class="fu">chi2</span>(9)        =     151.91</span>
<span id="cb33-25"><a href="#cb33-25"></a>Dispersion     = <span class="kw">mean</span>                           Prob &gt; <span class="fu">chi2</span>       =     0.0000</span>
<span id="cb33-26"><a href="#cb33-26"></a>Log likelihood = -7458.4576                     Pseudo R2         =     0.0101</span>
<span id="cb33-27"><a href="#cb33-27"></a></span>
<span id="cb33-28"><a href="#cb33-28"></a>─────────────┬────────────────────────────────────────────────────────────────</span>
<span id="cb33-29"><a href="#cb33-29"></a>    numprobs │      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]</span>
<span id="cb33-30"><a href="#cb33-30"></a>─────────────┼────────────────────────────────────────────────────────────────</span>
<span id="cb33-31"><a href="#cb33-31"></a>  coninc_10K │   .0286549   .0049747     5.76   0.000     .0189047    .0384052</span>
<span id="cb33-32"><a href="#cb33-32"></a>             │</span>
<span id="cb33-33"><a href="#cb33-33"></a>        race │</span>
<span id="cb33-34"><a href="#cb33-34"></a>      <span class="bn">black</span>  │  -.4378139   .0599275    -7.31   0.000    -.5552697    -.320358</span>
<span id="cb33-35"><a href="#cb33-35"></a>      other  │   -.248534   .0944197    -2.63   0.008    -.4335933   -.0634747</span>
<span id="cb33-36"><a href="#cb33-36"></a>             │</span>
<span id="cb33-37"><a href="#cb33-37"></a>        hisp │  -.2523914   .0861951    -2.93   0.003    -.4213307    -.083452</span>
<span id="cb33-38"><a href="#cb33-38"></a>             │</span>
<span id="cb33-39"><a href="#cb33-39"></a>       <span class="kw">class</span> │</span>
<span id="cb33-40"><a href="#cb33-40"></a>working c..  │  -.1323204   .0890544    -1.49   0.137    -.3068639     .042223</span>
<span id="cb33-41"><a href="#cb33-41"></a>middle cl..  │  -.0193732    .091597    -0.21   0.832       -.1989    .1601535</span>
<span id="cb33-42"><a href="#cb33-42"></a><span class="fu">upper</span> <span class="kw">class</span>  │   -.066233   .1389252    -0.48   0.634    -.3385213    .2060554</span>
<span id="cb33-43"><a href="#cb33-43"></a>             │</span>
<span id="cb33-44"><a href="#cb33-44"></a>         sex │   .1082123   .0393212     2.75   0.006     .0311442    .1852805</span>
<span id="cb33-45"><a href="#cb33-45"></a>         age │  -.0013676   .0011595    -1.18   0.238    -.0036401    .0009049</span>
<span id="cb33-46"><a href="#cb33-46"></a>       <span class="dt">_cons</span> │   1.975325   .1187731    16.63   0.000     1.742534    2.208116</span>
<span id="cb33-47"><a href="#cb33-47"></a>─────────────┼────────────────────────────────────────────────────────────────</span>
<span id="cb33-48"><a href="#cb33-48"></a>    /lnalpha │   -.246852   .0319159                      -.309406    -.184298</span>
<span id="cb33-49"><a href="#cb33-49"></a>─────────────┼────────────────────────────────────────────────────────────────</span>
<span id="cb33-50"><a href="#cb33-50"></a>       <span class="kw">alpha</span> │   .7812563   .0249345                      .7338827    .8316879</span>
<span id="cb33-51"><a href="#cb33-51"></a>─────────────┴────────────────────────────────────────────────────────────────</span>
<span id="cb33-52"><a href="#cb33-52"></a>LR <span class="kw">test</span> <span class="kw">of</span> <span class="kw">alpha</span>=0: chibar2(01) = 1.3e+04              Prob &gt;= chibar2 = 0.000</span></code></pre></div>
</div><div id="predicted-values" class="slide section level2">
<h1>Predicted Values</h1>
</div><div id="exposure" class="slide section level2">
<h1>Exposure</h1>
<p>In some data sets, we will have a <em>years exposed</em> or <em>time exposed</em> variable. It is important to control for this variable.</p>
</div>
<div id="zero-inflated-models" class="title-slide slide section level1"><h1>Zero-Inflated Models</h1></div>
</body>
</html>
